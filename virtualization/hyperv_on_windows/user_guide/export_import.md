# 导出和导入虚拟机

可以使用 Hyper-V 的导出和导入功能快速复制虚拟机。 导出的虚拟机可用于备份，也可作为移动 Hyper-V 主机之间的虚拟机的方法。

导入使你可以还原虚拟机。 无需为了导入而导出虚拟机。 导入将尝试从任何可用的内容重新创建虚拟机。 使用**导入虚拟机**向导来指定文件的位置。 这会将向 Hyper-V 注册虚拟机，并使其可供使用。

本文档将指导完成导出和导入虚拟机的过程，并介绍一些执行这些任务时可以进行的选择。

## 导出虚拟机

### 使用 Hyper-V 管理器

在创建虚拟机的导出时，所有关联文件会捆绑到该导出中。 这包括配置文件、硬盘驱动器文件，还包括任何现有检查点文件。 若要创建虚拟机导出：

1. 在 Hyper-V 管理器中，右键单击所需的虚拟机，然后选择“导出”。

2. 指定用于存储已导出文件的位置，然后单击“导出”按钮。

**注意：**可以在处于启动或停止状态的虚拟机上运行此过程。

导出完成后，可以在导出位置下查看所有导出的文件。

### 使用 PowerShell

若要使用 PowerShell 导出虚拟机，请使用 **Export-VM** 命令。

```powershell
Export-VM -Name <vm name> -Path <path>
```

有关使用 Windows PowerShell 导出虚拟机的信息，请参阅 [Export-VM](https://technet.microsoft.com/library/hh848491.aspx)

## 导入虚拟机

导入虚拟机会向 Hyper-V 主机注册该虚拟机。 虚拟机导出可以导入回其所源自的主机或导入新主机。

Hyper-V 包括三种导入类型：

- **就地注册** – 导出文件已放入虚拟机应从中运行的位置。 导入完成后，虚拟机具有与导出时相同的 ID。 因此，如果已向 Hyper-V 注册了虚拟机，需要将其删除，然后才能使导入生效。 导入完成后，导出文件将变为运行状态文件并且不能删除。

- **还原虚拟机** – 系统会提供给你一个选项，以便将 VM 文件存储在特定位置或使用 Hyper-V 的默认位置。 此导入类型将创建已导出文件的副本，并将其移动到选定位置。 导入完成后，虚拟机具有与导出时相同的 ID。 因此，如果虚拟机已在 Hyper-V 中运行，需要将其删除，然后才能完成导入。 导入完成后，已导出文件保持不变，可删除和/或重新导入。

- **复制虚拟机** – 此导入类型在选择 VM 文件的位置方面与“还原”类型相似。 不同之处在于，导入时虚拟机具有新的唯一 ID。 这使得虚拟机可多次导入同一主机。


### 使用 Hyper-V 管理器

若要将虚拟机导入到 Hyper-V 主机中：

1. 在 Hyper-V 管理器中，从操作菜单单击“导入虚拟机”。

2. 在“开始之前”屏幕上，单击“下一步”。

3. 选择包含已导出文件的文件夹，然后单击“下一步”。

4. 选择要导入的虚拟机，很可能只有一个选项。

5. 从三个选项之一中选择导入类型，然后单击“下一步”。

6. 在“摘要”屏幕上，选择“完成”。

“导入虚拟机”向导还向你演练在将虚拟机导入到新主机时处理不兼容问题的步骤，因此此向导有助于与物理硬件相关联的配置，如内存、虚拟交换机和虚拟处理器。

若要导入虚拟机，该向导将执行以下操作：
1. 创建虚拟机配置文件的副本。 此操作作为预防措施完成，以防止主机发生意外重启，例如由于电源断电。

2. 验证硬件。 将虚拟机配置文件中的信息与新主机上的硬件进行比较。

3. 编译错误列表。 此列表标识哪些内容需要重新配置，并确定向导中的下一步显示哪些页。

4. 显示相关页，一次显示一个类别。 该向导说明每个不兼容项，以帮助你重新配置虚拟机，使其与新主机相兼容。

5. 删除配置文件的副本。 该向导完成此操作后，虚拟机已准备好启动。


### 使用 PowerShell

若要使用 PowerShell 导入虚拟机，请使用 **Import-VM** 命令。 以下命令演示使用 PowerShell 导入三种导入类型的每一种。

若要完成虚拟机的就地导入，该命令将与此类似。 回想一下，就地导入使用导入时其存储位置中的文件，并保留虚拟机 ID。

```powershell
Import-VM -Path 'C:\<emport path>\2B91FEB3-F1E0-4FFF-B8BE-29CED892A95A.vmcx' 
```

若要导入自行指定虚拟机文件路径的虚拟机，该命令将与此类似。

```powershell
Import-VM -Path ‘C:\<vm export path>\2B91FEB3-F1E0-4FFF-B8BE-29CED892A95A.vmcx' -Copy -VhdDestinationPath 'D:\Virtual Machines\WIN10DOC' -VirtualMachinePath 'D:\Virtual Machines\WIN10DOC'
```

若要完成复制导入并将虚拟机文件移动到默认的 Hyper-V 位置，该命令将与此类似。

``` PowerShell
Import-VM -Path 'C:\<vm export path>\2B91FEB3-F1E0-4FFF-B8BE-29CED892A95A.vmcx' -Copy -GenerateNewId
```

有关详细信息，请参阅 [Import-VM](https://technet.microsoft.com/library/hh848495.aspx)。





<!--HONumber=Feb16_HO4-->


